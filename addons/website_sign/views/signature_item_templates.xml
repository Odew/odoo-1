<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="website_sign.items_view" name="Digital Signatures - Items View">
        <form id="sign_doc_items" method="post" t-attf-action="/website_sign/signed/{{signature_request.id}}/{{token}}">
            <div id="signature-field-view">
                <input id="input_signature_request_id" type="hidden" t-att-value="signature_request.id"/>
                <input id="input_attachment_location" type="hidden" t-attf-value="/website_sign/download/{{signature_request.id}}/origin"/>
                <input id="input_field_readonly" type="hidden" t-att-value="readonly"/>
                <input id="input_current_role" type="hidden" t-att-value="role"/>

                <t t-call="website_sign.item_types_input_info"/>

                <div id="canvas-container">
                    <iframe id="iframe-view"/>
                    <t t-call="website_sign.items_input_info"/>
                </div>
            </div>
        </form>
        <t t-call="website_sign.signature_dialog">
            <t t-set="signer_name" t-value="Name"/>
            <t t-if="current_request_item">
                <t t-set="signer_name" t-value="current_request_item.partner_id.name"/>
            </t> 
        </t>
    </template>
    
	<template t-name="website_sign.items_edit" name="Signature Request - Fields Edition">
		<t t-call="website.layout">
            <div id="signature-field-view" class="container">
            	<h2><strong><t t-esc="signature_request_template.attachment.name"/></strong> - Signature Request - Fields Edition</h2>
            	<ul>
                    <li>Notice that if you leave your document without any fields, the signers will be requested for an unique signature alongside the document.</li>
                </ul>

                <div class="row">
            		<div class="col-md-3">
            			<input id="input_signature_request_template_id" type="hidden" t-att-value="signature_request_template.id"/>
            			<input id="input_attachment_location" type="hidden" t-att-value="'/web/binary/image?model=ir.attachment&amp;field=datas&amp;id=' + str(signature_request_template.attachment.id)"/>

                        <t t-call="website_sign.item_types_input_info"/>

            			<div class="panel panel-default">
                            <div class="panel-heading">
                				<a t-att-href="'/web?#id=' + str(signature_request_template.id) + '&amp;view_type=form&amp;model=signature.request.template'" id="signature_fields_save" class="btn btn-primary btn-block fa fa-check">Save</a>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <h4 class="panel-heading modal-title">Basic Fields</h4>
    	        			<div class="panel-body">
                                <t t-foreach="signature_item_types" t-as="item_type">
                                    <button t-if="not item_type.auto_field" type="button" class="field_type_button btn btn-primary btn-block" t-att-data-item-type-id="item_type.id"><t t-esc="item_type.name"/></button>
                                </t>
                            </div>
    	        		</div>
                        <div class="panel panel-default">
                            <h4 class="panel-heading modal-title">Auto Fields</h4>
                            <div class="panel-body">
                                <t t-foreach="signature_item_types" t-as="item_type">
                                    <button t-if="item_type.auto_field" type="button" class="field_type_button btn btn-primary btn-block" t-att-data-item-type-id="item_type.id"><t t-esc="item_type.name"/></button>
                                </t>
                            </div>
                        </div>
            		</div>

            		<div id="canvas-container" class="col-md-9">
    	        		<iframe id="iframe-edit"/>
                        <t t-call="website_sign.items_input_info"/>
    	        	</div>

                    <div class="modal fade" id="responsibles_diag" role="dialog" data-toggle="modal" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-body">
                                <div class="form-group">
                                    <div class="panel panel-default mt16 mb0">
                                        <div class="panel-heading">
                                            <strong>Select the responsible</strong>
                                        </div>
                                        <div class="panel-body">
                                            <button type="button" data-dismiss="modal" data-party="0" class="btn btn-primary btn-block">Everyone</button>
                                            <t t-foreach="signature_item_parties" t-as="signature_item_party">
                                                <button type="button" data-dismiss="modal" t-att-data-party="signature_item_party.id" class="btn btn-primary btn-block"><t t-esc="signature_item_party.name"/></button>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
	</template>

    <template t-name="website_sign.items_input_info" name="Items input info">
        <t t-foreach="signature_items" t-as="item">
            <input type="hidden"
                t-att-data-item-id="item.id"
                t-att-data-type="item.type.id"
                t-att-data-required="item.required"
                t-att-data-responsible="item.responsible.id"
                t-att-data-page="item.page"
                t-att-data-posx="item.posX"
                t-att-data-posy="item.posY"
                t-att-data-width="item.width"
                t-att-data-height="item.height"
                t-att-data-item-value="item.valueFor(signature_request.id) if signature_request else ''"/>
        </t>
    </template>

    <template t-name="website_sign.item_types_input_info" name="Item types input info">
        <t t-foreach="signature_item_types" t-as="item_type">
            <input type="hidden" class="field_type_input_info" 
                t-att-data-item-type-id="item_type['id']"
                t-att-data-item-type-name="item_type['name']"
                t-att-data-item-type-type="item_type['type']"
                t-att-data-item-type-tip="item_type['tip']"
                t-att-data-item-type-placeholder="item_type['placeholder']"
                t-att-data-item-type-width="item_type['default_width']"
                t-att-data-item-type-height="item_type['default_height']"
                t-att-data-item-type-auto="item_type['auto_field']"/>
        </t>
    </template>
</odoo>
