<?xml version="1.0"?>
<odoo>
    <record id="signature_access_mail_template" model="mail.template">
        <field name="name">Document Sign Request</field>
        <field name="model_id" ref="website_sign.model_signature_request"/>
        <field name="auto_delete" eval="True"/>
        <field name="email_from">${ctx['email_from']|safe}</field>
        <field name="email_to">${ctx['email_to']|safe}</field>
        <field name="subject">Signature request from ${ctx['email_from_usr']} for ${ctx['docnames']}</field>
        <field name="body_html"><![CDATA[
            <center>
                <table width = "60%">
                    <tbody>
                        <tr>
                            <td style="background-color:#ffffff;border:1px solid #ccc;padding:10px 10px 5px 10px" bgcolor="FFFFFF" align="center">
                                <h1 style="font-size:14px">
                                    ${ctx['email_from_usr']} has requested your signature
                                </h1>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table width="60%">
                    <tbody>
                        <tr>
                            <td style="background-color:#ffffff;border:1px solid #ccc;padding:40px 40px 30px 40px" bgcolor="FFFFFF">
                                <h1 style="font-size:18px;margin:0 0 10px 0;font-weight:bold">${ctx['docnames']}</h1>
                                <p style="line-height:1.4em;font-size:14px;margin:10px 0px">
                                    <span style="color:#8c8c8c">From: ${ctx['email_from_usr']}  -
                                        <a href="mailto:${ctx['email_from']}?subject=RE:" style="color:#368bc6;text-decoration:none" target="_blank">Reply</a>
                                    </span>
                                </p>
                                % if ctx['msgbody']:
                                    <hr style="color:#cccccc;background-color:#cccccc;min-height:1px;border:none"/>
                                    <p style="margin:20px 0px 20px 0px">
                                        ${ctx['msgbody'] | safe}
                                    </p>
                                % endif
                                <hr style="color:#cccccc;background-color:#cccccc;min-height:1px;border:none"/>
                                <div style="margin:20px 0px 20px 0px">
                                    <table>
                                        <tbody>
                                            <tr>
                                                % for link in ctx['links']:
                                                    <td style='padding:9px 16px 9px 16px;font-size:16px;color:#f7fbfd;background-color:#0088cc'>
                                                        <a style='text-decoration:none;font-size:16px;color:#f7fbfd' href=${link[0]}>
                                                            <span style='color:#f7fbfd'>Sign on ${link[1]}</span>
                                                        </a>
                                                    </td>
                                                % endfor
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <hr style="color:#cccccc;background-color:#cccccc;min-height:1px;border:none">
                                <p style="margin:10px 0px;font-size:14px;line-height:1.4em;color:#ff0000">Warning: do not forward this email to others or else they will be able to access your document.</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </center>
        ]]>
        </field>
    </record>

    <record id="completed_signature_mail_template" model="mail.template">
        <field name="name">Document Sign Completed</field>
        <field name="model_id" ref="website_sign.model_signature_request"/>
        <field name="auto_delete" eval="True"/>
        <field name="email_from">${ctx['email_from']|safe}</field>
        <field name="email_to">${ctx['email_to']|safe}</field>
        <field name="subject">Completed document ${ctx['docnames']}</field>
        <field name="body_html"><![CDATA[
            <center>
                <table width = "60%">
                    <tbody>
                        <tr>
                            <td style="background-color:#ffffff;border:1px solid #ccc;padding:10px 10px 5px 10px" bgcolor="FFFFFF" align="center">
                                <h1 style="font-size:14px">
                                    The document you signed has been completed by everyone !
                                </h1>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table width="60%">
                    <tbody>
                        <tr>
                            <td style="background-color:#ffffff;border:1px solid #ccc;padding:40px 40px 30px 40px" bgcolor="FFFFFF">
                                <h1 style="font-size:18px;margin:0 0 10px 0;font-weight:bold">${ctx['docnames']}</h1>
                                <p style="line-height:1.4em;font-size:14px;margin:10px 0px">
                                    <span style="color:#8c8c8c">From: ${ctx['email_from_usr']}  -
                                        <a href="mailto:${ctx['email_from']}?subject=RE:" style="color:#368bc6;text-decoration:none" target="_blank">Reply</a>
                                    </span>
                                </p>
                                <hr style="color:#cccccc;background-color:#cccccc;min-height:1px;border:none"/>
                                <div style="margin:20px 0px 20px 0px">
                                    <table>
                                        <tbody>
                                            <tr>
                                                % for link in ctx['links']:
                                                    <td style='padding:9px 16px 9px 16px;font-size:16px;color:#f7fbfd;background-color:#0088cc'>
                                                        <a style='text-decoration:none;font-size:16px;color:#f7fbfd' href=${link[0]}>
                                                            <span style='color:#f7fbfd'>Get completed document ${link[1]}</span>
                                                        </a>
                                                    </td>
                                                % endfor
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </center>
        ]]>
        </field>
    </record>

    <!-- Signature request workflow -->
    <record model="workflow" id="wkf_signature_request">
        <field name="name">Signature request workflow</field>
        <field name="osv">signature.request</field>
        <field name="on_create">True</field>
    </record>

    <record model="workflow.activity" id="signature_request_draft">
        <field name="name">Draft</field>
        <field name="wkf_id" ref="wkf_signature_request"/>
        <field name="flow_start" eval="True"/>
        <field name="kind">function</field>
        <field name="action">action_draft()</field>
    </record>
    <record model="workflow.activity" id="signature_request_opened">
        <field name="name">Opened</field>
        <field name="wkf_id" ref="wkf_signature_request"/>
        <field name="kind">function</field>
        <field name="action">action_opened()</field>
    </record>
    <record model="workflow.activity" id="signature_request_closed">
        <field name="name">Closed</field>
        <field name="wkf_id" ref="wkf_signature_request"/>
        <field name="kind">function</field>
        <field name="action">action_closed()</field>
    </record>
    <record model="workflow.activity" id="signature_request_canceled">
        <field name="name">Canceled</field>
        <field name="wkf_id" ref="wkf_signature_request"/>
        <field name="kind">function</field>
        <field name="action">action_canceled()</field>
    </record>

    <record model="workflow.transition" id="signature_request_draft_to_opened">
        <field name="act_from" ref="signature_request_draft"/>
        <field name="act_to" ref="signature_request_opened"/>
        <field name="signal">signature_request_launch</field>
    </record>
    <record model="workflow.transition" id="signature_request_draft_to_opened2">
        <field name="act_from" ref="signature_request_draft"/>
        <field name="act_to" ref="signature_request_opened"/>
        <field name="condition">nb_draft == 0</field>
    </record>
    <record model="workflow.transition" id="signature_request_opened_to_draft">
        <field name="act_from" ref="signature_request_opened"/>
        <field name="act_to" ref="signature_request_draft"/>
        <field name="condition">nb_draft > 0</field>
    </record>
    <record model="workflow.transition" id="signature_request_opened_to_closed">
        <field name="act_from" ref="signature_request_opened"/>
        <field name="act_to" ref="signature_request_closed"/>
        <field name="condition">nb_closed == len(request_items)</field>
    </record>
    <record model="workflow.transition" id="signature_request_closed_to_draft">
        <field name="act_from" ref="signature_request_closed"/>
        <field name="act_to" ref="signature_request_draft"/>
        <field name="condition">nb_draft > 0</field>
    </record>
    <record model="workflow.transition" id="signature_request_draft_to_canceled">
        <field name="act_from" ref="signature_request_draft"/>
        <field name="act_to" ref="signature_request_canceled"/>
        <field name="signal">signature_request_cancel</field>
    </record>
    <record model="workflow.transition" id="signature_request_opened_to_canceled">
        <field name="act_from" ref="signature_request_opened"/>
        <field name="act_to" ref="signature_request_canceled"/>
        <field name="signal">signature_request_cancel</field>
    </record>
    <record model="workflow.transition" id="signature_request_closed_to_canceled">
        <field name="act_from" ref="signature_request_closed"/>
        <field name="act_to" ref="signature_request_canceled"/>
        <field name="signal">signature_request_cancel</field>
    </record>
    <record model="workflow.transition" id="signature_request_canceled_to_draft">
        <field name="act_from" ref="signature_request_canceled"/>
        <field name="act_to" ref="signature_request_draft"/>
        <field name="signal">signature_request_draft</field>
    </record>
</odoo>
