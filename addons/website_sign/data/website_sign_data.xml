<?xml version="1.0"?>
<openerp>
    <data>
        <record id="action_client_digital_signature_menu" model="ir.actions.client">
            <field name="name">Open Digital Signatures Menu</field>
            <field name="tag">reload</field>
            <field name="params" eval="{'menu_id': ref('website_sign.menu_digital_signatures')}"/>
        </record>
        <record id="base.open_menu" model="ir.actions.todo">
            <field name="action_id" ref="action_client_digital_signature_menu"/>
            <field name="state">open</field>
        </record>

        <record id="request_sign_template" model="mail.template">
            <field name="name">Document Sign Request</field>
            <field name="model_id" ref="website_sign.model_signature_request_item"/>
            <field name="auto_delete" eval="True"/>
            <field name="email_from">${ctx['email_from']|safe}</field>
            <field name="email_to">${ctx['email_to']|safe}</field>
            <field name="subject">Signature request from ${ctx['email_from_usr']} for ${ctx['docnames']}</field>
            <field name="body_html"><![CDATA[
                <center>
                    <table width = "60%">
                        <tbody>
                            <tr>
                                <td style="background-color:#ffffff;border:1px solid #ccc;padding:10px 10px 5px 10px" bgcolor="FFFFFF" align="center">
                                    <h1 style="font-size:14px">
                                        ${ctx['email_from_usr']} has requested your signature
                                    </h1>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table width="60%">
                        <tbody>
                            <tr>
                                <td style="background-color:#ffffff;border:1px solid #ccc;padding:40px 40px 30px 40px" bgcolor="FFFFFF">
                                    <h1 style="font-size:18px;margin:0 0 10px 0;font-weight:bold">${ctx['docnames']}</h1>
                                    <p style="line-height:1.4em;font-size:14px;margin:10px 0px">
                                        <span style="color:#8c8c8c">From: ${ctx['email_from_usr']}  -
                                            <a href="mailto:${ctx['email_from']}?subject=RE:" style="color:#368bc6;text-decoration:none" target="_blank">Reply</a>
                                        </span>
                                    </p>
                                    % if ctx['msgbody']:
                                        <hr style="color:#cccccc;background-color:#cccccc;min-height:1px;border:none"/>
                                        <p style="margin:20px 0px 20px 0px">
                                            ${ctx['msgbody'] | safe}
                                        </p>
                                    % endif
                                    <hr style="color:#cccccc;background-color:#cccccc;min-height:1px;border:none"/>
                                    <div style="margin:20px 0px 20px 0px">
                                        <table>
                                            <tbody>
                                                <tr>
                                                    % for link in ctx['links']:
                                                        <td style='padding:9px 16px 9px 16px;font-size:16px;color:#f7fbfd;background-color:#0088cc'>
                                                            <a style='text-decoration:none;font-size:16px;color:#f7fbfd' href=${link[0]}>
                                                                <span style='color:#f7fbfd'>Sign on ${link[1]}</span>
                                                            </a>
                                                        </td>
                                                    % endfor
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <hr style="color:#cccccc;background-color:#cccccc;min-height:1px;border:none">
                                    <p style="margin:10px 0px;font-size:14px;line-height:1.4em;color:#ff0000">Warning: do not forward this email to others or else they will be able to access your document.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </center>
            ]]>
            </field>
        </record>

        <record model="ir.ui.view" id="signature_requests_tree_view">
            <field name="name">Signature Request Tree View</field>
            <field name="model">signature.request</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="attachment"/>
                    <field name="nb_draft"/>
                    <field name="nb_wait"/>
                    <field name="nb_closed"/>
                    <!-- <field name="signature_items"/> -->
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="signature_requests_form_view">
            <field name="name">Signature Request Form View</field>
            <field name="model">signature.request</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button string="Send" type="workflow" states="draft" name="signature_request_launch" class="oe_highlight oe_read_only"/>
                        <button string="Draft" type="workflow" states="canceled" name="signature_request_draft" class="oe_hightlight oe_read_only"/>
                        <button string="Cancel" type="workflow" states="draft,opened,closed" name="signature_request_cancel" class="oe_read_only" confirm="This will delete all the already completed documents of this request and disable every sent accesses, are you sure?"/>
                        <button string="Set as template" type="object" name="set_as_template" class="oe_read_only"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <h2>Signature Request</h2>

                        <div class="oe_button_box oe_right">
                            <button string="View Signature Request" type="object" name="go_to_sign_document" class="oe_read_only"/>
                        </div>

                        <group>
                            <field name="attachment"/>
                        </group>
                        <label for="message"/><field name="message"/>

                        <group col="4">
                            <field name="request_items" context="{'default_signature_request': id}" nolabel="1" colspan="3"/>
                            <group colspan="1">
                                <field name="nb_draft"/>
                                <field name="nb_wait"/>
                                <field name="nb_closed"/>
                            </group>
                        </group>

                        <div class="oe_button_box oe_right">
                            <button string="Edit fields" type="object" name="go_to_custom_document" class="oe_read_only"/>
                        </div>
                        <label for="signature_items"/>
                        <field name="signature_items"/>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="signature_requests_search_view">
            <field name="name">Signature Request Search View</field>
            <field name="model">signature.request</field>
            <field name="arch" type="xml">
                <search>
                    <field name="attachment"/>
                    <filter name="draft_opened_signature_requests" string="Actif" domain="[('state', 'in', ['draft', 'opened'])]"/>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="view_signature_requests_action">
            <field name="name">Signature Requests</field>
            <field name="res_model">signature.request</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="signature_requests_search_view"/>
            <field name="context" eval="{'search_default_draft_opened_signature_requests': 1}"/>
        </record>

        <record model="ir.ui.view" id="signature_request_item_tree_view">
            <field name="name">Signature Request Item Tree View</field>
            <field name="model">signature.request.item</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="role" class="oe_read_only"/>
                    <field name="partner_id"/>
                    <field name="signer_email" class="oe_read_only"/>
                    <field name="state" class="oe_read_only"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="signature_request_item_form_view">
            <field name="name">Signature Request Item Form View</field>
            <field name="model">signature.request.item</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <h2>Signer</h2>

                        <group>
                            <field name="role"/>
                        </group>
                        <group>
                            <group>
                                <field name="partner_id"/>
                                <field name="signature_request"/>
                            </group>
                            <group>
                                <field name="access_token"/>
                                <field name="signing_date"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="signature_item_tree_view">
            <field name="name">Signature Item Tree View</field>
            <field name="model">signature.item</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="type"/>
                    <field name="required"/>
                    <field name="responsible"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="signature_party_tree_view">
            <field name="name">Signature Party Tree View</field>
            <field name="model">signature.item.party</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="signature_party_form_view">
            <field name="name">Signature Party Form View</field>
            <field name="model">signature.item.party</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="name"/>
                    </group>
                </form>
            </field>
        </record>

        <record model="ir.actions.act_window" id="view_signature_parties_action">
            <field name="name">Signature Parties</field>
            <field name="res_model">signature.item.party</field>
            <field name="view_mode">tree,form</field>
        </record>

         <!-- <menuitem parent="knowledge.menu_document" id="website_sign.menu_digital_signatures" name="Digital Signature"/> -->
        <!-- <menuitem parent="website_sign.menu_digital_signatures" id="website_sign.menu_signature_requests" name="Signatures Requests" action="view_signature_requests_action"/> -->
        <menuitem id="website_sign.menu_digital_signatures" name="Digital Signature"/>
        <menuitem parent="website_sign.menu_digital_signatures" id="website_sign.menu_digital_signatures2" name="Digital Signature"/>
        <menuitem parent="website_sign.menu_digital_signatures2" id="website_sign.menu_signature_requests" name="Signature Requests" action="view_signature_requests_action"/>
        <menuitem parent="website_sign.menu_digital_signatures2" id="website_sign.menu_signature_parties" name="Signature Parties" action="view_signature_parties_action"/>
    </data>
</openerp>
