<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>

  <template id="dashboard" name="Recurrent Revenue Dashboard" page="True">
    <t t-name="account_contract_dashboard.dashboard"/>
    <t t-call="website.layout">
    <div id="wrap" class="oe_structure oe_empty" style="background-color: #ebf1f4;">
      <div class="container">
          
          <div class="row">              
            <div class="col-sm-12 text-center">
              <h1 class="text-muted ">Recurrent Revenue Dashboard</h1>
            </div>
          </div>

          <hr/>

          <div class="row mb32">
            <div class="col-sm-12">
              <form action="/account_contract_dashboard">
                <div class="col-sm-4 text-left">
                  <a href="#">All products</a>
                </div>
                <div class="col-sm-8 text-right">
                  <input type="date" name="start_date" t-att-value="start_date"/> to <input type="date" name="end_date" t-att-value="end_date"/> <button class="btn btn-primary" type="submit">Update</button>
                </div>
              </form>
            </div>
          </div>

          <div class="row">
            <t t-foreach="all_stats" t-as="stat">
              <div class="col-sm-4">
                <a class="fill-div" t-att-href="'account_contract_dashboard/detailed/%s?start_date=%s&amp;end_date=%s' % (stat['code'], start_date, end_date)">
                  <div class="box stat-box" t-att-name="stat['name']" t-att-code="stat['code']">
                    <div class="loading">
                      <div id="big-circle">
                        <div id="little-circle">
                        </div>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            </t>
          </div>

      </div>

    </div>
    </t>
  </template>

  <template id="detailed_dashboard" name="Detailed Dashboard" page="True">
    <t t-name="account_contract_dashboard.detailed_dashboard"/>
    <t t-call="website.layout">
    <div id="wrap" class="oe_structure oe_empty" style="background-color: #ebf1f4;">
      <div class="container">
          
          <div class="row">              
            <div class="col-sm-12 text-center">
              <h1 class="text-muted "><t t-esc="report_name"/></h1>
            </div>
          </div>

          <hr/>

          <div class="row mb32">
            <div class="col-sm-12">
              <form t-att-action="'/account_contract_dashboard/detailed/%s' % stat_type">
                <div class="col-sm-4 text-left">
                  <div>
                    <a t-att-href="'/account_contract_dashboard?start_date=%s&amp;end_date=%s' % (start_date, end_date)">Dashboard</a>
                  </div>
                  <div>
                    <a href="#">All products</a>
                  </div>
                </div>
                <div class="col-sm-8 text-right">
                  <input type="date" name="start_date" t-att-value="start_date"/> to <input type="date" name="end_date" t-att-value="end_date"/> <button class="btn btn-primary" type="submit">Update</button>
                </div>
              </form>
            </div>
          </div>

          <div class="row">
            <div id="chart_div" class="box" style="height: 300px;">
              <input type="hidden" name="stat_type" t-att-value="stat_type"/>
            </div>
          </div>

          <div class="row box">
            <div class="col-md-3">
              <h4 class="text-muted upper">Current</h4>
              <h1><t t-esc="value_now['value']"/><t t-esc="currency"/></h1>
            </div>


            <div class="col-md-3">
              <h4 class="text-muted">1 MONTH AGO</h4>
              <h1><t t-esc="value_1_month_ago['value']"/><t t-esc="currency"/> <small t-if="not value_1_month_ago['value'] == 0" t-attf-class="#{rate(stat_type, value_1_month_ago['value'], value_now['value'])[1]}"><t t-esc="rate(stat_type, value_1_month_ago['value'], value_now['value'])[0]"/>%</small></h1>
            </div>


            <div class="col-md-3">
              <h4 class="text-muted">3 MONTHS AGO</h4>
              <h1><t t-esc="value_3_months_ago['value']"/><t t-esc="currency"/> <small t-if="not value_3_months_ago['value'] == 0" t-attf-class="#{rate(stat_type, value_3_months_ago['value'], value_now['value'])[1]}"><t t-esc="rate(stat_type, value_3_months_ago['value'], value_now['value'])[0]"/>%</small></h1>
            </div>


            <div class="col-md-3">
              <h4 class="text-muted">12 MONTHS AGO</h4>
              <h1><t t-esc="value_12_months_ago['value']"/><t t-esc="currency"/> <small t-if="not value_12_months_ago['value'] == 0" t-attf-class="#{rate(stat_type, value_12_months_ago['value'], value_now['value'])[1]}"><t t-esc="rate(stat_type, value_12_months_ago['value'], value_now['value'])[0]"/>%</small></h1>
            </div>
          </div>

          <div class="row">
            <div t-if="stat_type == 'mrr'" class="box" style="height: 300px;">
              <h3>Monthly Recurring Revenue Growth</h3>
            </div>
          </div>

          <div t-if="stats_by_plan" class="row">
            <div class="box">
              <table class="table table-striped">
                <tr>
                  <th>Plan</th>
                  <th>Customers</th>
                  <th t-if="not stat_type == 'recurring_quant'"><t t-esc="report_name"/></th>
                </tr>
                <t t-foreach="stats_by_plan" t-as="plan">
                  <tr>
                    <td><t t-esc="plan['name']"/></td>
                    <td t-att-class="'oGreen' if plan['nb_customers'] > 0 else 'grey'"><t t-esc="plan['nb_customers']"/></td>
                    <td t-if="not stat_type == 'recurring_quant'" t-att-class="'oGreen' if plan['value'] > 0 else 'grey'"><t t-esc="plan['value']"/><t t-esc="currency"/></td>
                  </tr>
                </t>
              </table>
            </div>
          </div>

      </div>

    </div>
    </t>
  </template>
   
  </data>
</openerp>